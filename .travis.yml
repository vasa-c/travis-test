language: php

matrix:
  include:
    - php: 5.4
      env: CHECKS=yes
    - php: 5.5
    - php: hhvm
      # no debug
      env: NOXDEBUG=yes

sudo: false

before_install:
  - if [ ! "$NOXDEBUG" = "yes" ]; then mv /home/travis/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini .; fi;
  - composer self-update

install:
  #
  - composer install --prefer-source
  
  # This is comment
  #
  - if [ "$CHECKS" = "yes" ]; then composer require squizlabs/php_codesniffer="~2.3" --prefer-source; fi;
  - if [ "$CHECKS" = "yes" ]; then composer require satooshi/php-coveralls --dev --prefer-source; fi;
  - >
    if [ "$CHECKS" = "yes" ]; then 
        echo "src_dir: ." > .coveralls.yml &&
        echo "json_path: coveralls-upload.json" >> .coveralls.yml &&
        echo "coverage_clover: clover.xml" >> .coveralls.yml &&
        cat .coveralls.yml
    fi;
  - if [ "$CHECKS" = "yes" ]; then phpenv config-add xdebug.ini $EXT_DIR; fi;    

script:
  - if [ ! "$CHECKS" = "yes" ]; then phpunit; fi;
  - if [ "$CHECKS" = "yes" ]; then php vendor/bin/phpcs --standard=PSR2 --encoding=utf-8 --ignore=vendor .; fi;    
  - if [ "$CHECKS" = "yes" ]; then phpunit --coverage-clover clover.xml; fi;
  - if [ "$CHECKS" = "yes" ]; then php vendor/bin/coveralls -c .coveralls.yml; fi;

notifications:
  email:
    on_success: change
    on_failure: always

