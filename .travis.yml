language: php

matrix:
  include:
    - php: 5.4
      env: CHECKS=yes
   # - php: 5.5
   # - php: hhvm
   #   env: NOXDEBUG=yes

sudo: false

before_install:
  - pwd
  - LOCAL_DIR="build"
  - EXT_DIR="/home/travis/.phpenv/versions/5.4/etc/conf.d"
  - phpenv --help
  - if [ ! "$NOXDEBUG" = "yes" ]; then 
        mkdir -p $LOCAL_DIR &&
        mv $EXT_DIR"/xdebug.ini" $LOCAL_DIR"/xdebug.ini";
    fi;
  - composer self-update

install:
  - composer install
  - >
    if [ "$CHECKS" = "yes" ]; then 
        composer require satooshi/php-coveralls --dev &&
        composer require squizlabs/php_codesniffer="~2.3"
    fi;

script:
  - >
    if [ "$CHECKS" = "yes" ]; then 
        mv $LOCAL_DIR"/xdebug.ini" $EXT_DIR"/xdebug.ini" &&
        mkdir -p build/logs &&
        phpunit --coverage-clover build/logs/clover.xml &&
        [[ -e build/logs/clover.xml ]] &&
        php vendor/bin/phpcs --standard=PSR2 --encoding=utf-8 --ignore=vendor .
    else
        phpunit;
    fi;

after_success:
  - if [ "$CHECKS" = "yes" ]; then php vendor/bin/coveralls -c .coveralls.yml; fi;

notifications:
  email:
    on_success: change
    on_failure: always
